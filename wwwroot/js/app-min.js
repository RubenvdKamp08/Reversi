"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var SPA=function(e){var t={environment:""};return{init:function(e){return t.environment=e,SPA.Model.init(),!0}}}(jQuery);SPA.Data=function(e){var t={environment:"production",host:"https://localhost:44339/",endpoints:{getSpellen:{method:"GET",url:"api/Spel/"}}};return{getDog:function(){e.get("https://random.dog/woof.json",function(t){t.url.endsWith(".mp4")?e(".dog").append(e("<video controls autoplay>").attr("width","640").attr("height","360").append(e("<source>").attr("src",t.url).attr("type","video/mp4"))):e(".dog").append(e("<img>").attr("src",t.url))})},init:function(e){return t.environment=e,!0},getSpellen:function(n,r){return new Promise(function(r,a){"production"==t.environment&&e.get(t.host+t.endpoints.getSpellen.url+n,function(e){r(e)}).fail(function(){a("server niet beschikbaar")})})},makeMove:function(n,r,a,i){return new Promise(function(o,s){e.ajax({url:t.host+t.endpoints.getSpellen.url+"zet/1",method:"PUT",contentType:"application/json; charset=utf-8",data:JSON.stringify({SpelToken:a,SpelerToken:i,X:n,Y:r,Pas:"false"}),success:function(e){o(e)},fail:function(e){s(e)}})})},makePas:function(n,r){return new Promise(function(a,i){e.ajax({url:t.host+t.endpoints.getSpellen.url+"zet/1",method:"PUT",contentType:"application/json; charset=utf-8",data:JSON.stringify({SpelToken:n,SpelerToken:r,X:0,Y:0,Pas:"true"}),success:function(e){a(e)},fail:function(e){i(e)}})})},giveUp:function(n){return new Promise(function(r,a){e.ajax({url:t.host+t.endpoints.getSpellen.url+"opgeven",method:"POST",contentType:"application/json, charset=utf-8",data:JSON.stringify({Token:n}),success:function(e){r(e)},fail:function(e){a(e)}}).fail(function(){a("problemen met server")})})}}}(jQuery),SPA.Model=function(e){var t,n=null,r=null,a=null,i=null,o=null,s=null,l=null,u=null,c=null,d=function(){SPA.Data.getSpellen(n,r).then(function(t){s=t.aanDeBeurt,1==t.aanDeBeurt?i="wit":2==t.aanDeBeurt&&(i="zwart"),0==t.aanDeBeurt&&(e(".gameEnded").append(e("<a>").attr("href","/afterGame").html("stop game")),clearInterval(null),e(".informationGame").find(".set").html("geen zetten mogelijk")),null==o&&(t.spelerWitToken==r?(o="wit",l=1):t.spelerZwartToken==r&&(o="zwart",l=2)),a=t.aanDeBeurt,c=t.bordArray,SPA.Reversi.generateBoard(v(t.bordArray,u)),m(),h(),SPA.Grafiek.toonGrafiek(p(),g())}).then(function(){setInterval(function(){SPA.Data.getSpellen(n,r).then(function(t){1==t.aanDeBeurt?i="wit":2==t.aanDeBeurt&&(i="zwart"),s=t.aanDeBeurt,0==t.aanDeBeurt&&(e(".gameEnded").html(e("<a>").attr("href","/afterGame").html("stop game")),clearInterval(null),e(".informationGame").find(".set").html("geen zetten mogelijk")),null==o&&(t.spelerWitToken==r?(o="wit",l=1):t.spelerZwartToken==r&&(o="zwart",l=2)),"X"!=t.spelerWitToken&&"X"!=t.spelerZwartToken||(window.location="/afterGame"),a!=t.aanDeBeurt&&(a=t.aanDeBeurt,h()),S(c,t.bordArray)&&(console.log(c),console.log(t.bordArray),u=c,c=t.bordArray,SPA.Reversi.generateBoard(v(t.bordArray,u)),m(),SPA.Grafiek.toonGrafiek(p(),g()))})},1500)})},f=function(){console.log(r),SPA.Data.giveUp(r).then(function(e){console.log(e)})},p=function(){for(var e=0,t=0;t<=7;t++)for(var n=0;n<=7;n++)1==c[t][n]&&e++;return e},g=function(){for(var e=0,t=0;t<=7;t++)for(var n=0;n<=7;n++)2==c[t][n]&&e++;return e},m=function(){for(var e=0,t=0,n=0;n<=7;n++)for(var r=0;r<=7;r++)1==c[n][r]?e++:2==c[n][r]&&t++;SPA.Reversi.showScore(e,t)},h=function(){SPA.Reversi.showGameInformation(o,i)},v=function(e,t){for(var n=[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],r=0;r<=7;r++)for(var a=0;a<=7;a++)n[r][a]=e[r][a],null!==t&&e[r][a]!==t[r][a]&&(1===e[r][a]?n[r][a]=11:2===e[r][a]&&(n[r][a]=22));return n},S=function(e,t){for(var n=0;n<7;n++)for(var r=0;r<7;r++)if(e[n][r]!=t[n][r])return!0};return _defineProperty(t={giveUp:f},"giveUp",f),_defineProperty(t,"makeMove",function(e,t){console.log("mijn nummer: "+l+", nummer aanzet: "+s),l==s?SPA.Data.makeMove(e,t,n,r).then(function(e){s==e.aanDeBeurt&&SPA.FeedbackWidget.toonErrorWidget("geen goede zet","#widget-container"),s=e.aanDeBeurt}).catch(function(e){SPA.FeedbackWidget.toonErrorWidget(e,"#widget-container")}):SPA.FeedbackWidget.toonErrorWidget("je bent niet aan de beurt","#widget-container")}),_defineProperty(t,"makePas",function(){l==s?SPA.Data.makePas(n,r).then(function(e){s!=e.aanDeBeurt&&SPA.FeedbackWidget.toonSuccessWidget("je hebt een beurt overgeslagen","#widget-container")}):SPA.FeedbackWidget.toonErrorWidget("je bent niet aan de beurt","#widget-container")}),_defineProperty(t,"init",function(){var e=window.location.href.toString(),t=e.match(/\#(?:gameToken)\=([\S\s]*?)\&/)[1],a=e.match(/\#(?:playerToken)\=([\S\s]*?)\&/)[1];return n=t,r=a,SPA.Api.init(),d(),!0}),t}(jQuery),SPA.Reversi=function(e){var t,n=function(){e(".board td").click(function(){var t=parseInt(e(this).index())+1,n=parseInt(e(this).parent().index())+1;SPA.Model.makeMove(n,t)})},r=function(){e(".buttonPas").click(function(){SPA.Model.makePas()})},a=function(){e(".buttonGiveUp").click(function(){SPA.Model.giveUp()})},i=function(t,n){e(".score").html(spa_templates.src.js.templates.score({black:n,white:t}))},o=function(t,n){e(".gameInformation").html(spa_templates.src.js.templates.gameInformation({you:t,set:n}))};return _defineProperty(t={showGameInformation:o},"showGameInformation",o),_defineProperty(t,"showScore",i),_defineProperty(t,"generateBoard",function(t){e(".playground").html(SPA.Templating.parseTemplate("gameplay",{grid:t})),i(),n(),r(),a()}),_defineProperty(t,"init",function(){return!0}),t}(jQuery),SPA.FeedbackWidget=(jQuery,{init:function(){return!0},toonSuccessWidget:function(e,t){new Widget("Success",e,t).Build()},toonErrorWidget:function(e,t){new Widget("Warning",e,t).Build()}}),SPA.Api=(jQuery,{init:function(){SPA.Data.getDog()}}),SPA.Grafiek=(jQuery,{init:function(){},toonGrafiek:function(e,t){console.log(e);var n=document.getElementById("grafiek").getContext("2d");console.log("test"),new Chart(n,{type:"bar",data:{labels:["White","Black"],datasets:[{label:"Aantal fiches",data:[e,t],backgroundColor:["rgba(200, 200, 200, 1)","rgba(0, 0, 0, 1)"],borderColor:["rgba(200, 200, 200, 1)","rgba(0, 0, 0, 1)"],borderWidth:1}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}})}});var Widget=function(){function e(t,n,r){_classCallCheck(this,e),this.type=t,this.message=n,this.container=r}return _createClass(e,[{key:"Build",value:function(){this.ClearWidget(),this.CreateWidget(),this.AddEventListeners(),this.AddStorage()}},{key:"CreateWidget",value:function(){$(this.container).append($("<div>").attr("id","widget-success").append($("<div>").addClass("widget-symbol").append($("<i>").addClass("fas fa-check"))).append($("<div>").addClass("widget-exit").append($("<i>").addClass("fas fa-times"))).append($("<div>").addClass("widget-title").html()).append($("<div>").addClass("widget-content").html(this.message)).append($("<div>").addClass("widget-button-row").append($("<button>").html("Akkoord").addClass("btn").attr("id","ok")).append($("<button>").html("Annuleer").addClass("btn").attr("id","cancel")))),"Warning"===this.type&&($(".widget-symbol").find("i").remove("i"),$(".widget-symbol").append($("<i>").addClass("fas fa-exclamation-triangle")),$(".widget-button-row").hide(),$("#widget-success").attr("id","widget-warning"))}},{key:"AddEventListeners",value:function(){var e=this.container;$(".widget-exit").on("click",function(){$(e).animate({opacity:"-=1"},1500,function(){$(e).remove()})}),"Success"===this.type&&$(".btn").on("click",function(){$(e).animate({opacity:"-=1"},1500,function(){$(e).remove()})})}},{key:"ClearWidget",value:function(){var e=this.container;$(e).empty()}},{key:"AddStorage",value:function(){if(void 0===localStorage.items){for(var e=[],t=0;t<10;t+=1)e[t]="";localStorage.items=JSON.stringify(e)}else{var n=JSON.parse(localStorage.getItem("items"));n.push(this.type),n.shift(),localStorage.items=JSON.stringify(n)}console.log(localStorage)}}]),e}(),Template=(jQuery,{init:function(){return!0}});SPA.Templating=function(e){var t=function(e){return spa_templates.src.js.templates[e]};return{init:function(e){return this.templates=e,!0},getTemplate:t,parseTemplate:function(e,n){return t(e)(n)}}}(jQuery),Handlebars.registerHelper("ifEquals",function(e,t,n){return e===t?n.fn(this):n.inverse(this)}),Handlebars.registerHelper("times",function(e,t){for(var n="",r=0;r<e;++r)n+=t.fn(r);return n}),Handlebars.registerHelper("if_even",function(e,t){return e%2==0?t.fn(this):t.inverse(this)}),Handlebars.registerHelper("if_odd",function(e,t){return e%2==1?t.fn(this):t.inverse(this)}),Handlebars.registerHelper("if_changed",function(e){console.log(e)});