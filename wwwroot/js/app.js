"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var SPA=function(e){var t={environment:""};return{init:function(e){return t.environment=e,SPA.Model.init(),!0}}}(jQuery);SPA.Data=function(e){var t={environment:"production",host:"http://localhost:5001/",endpoints:{getSpellen:{method:"GET",url:"api/Spel/"}}},n=function(n,r){return new Promise(function(r,i){"production"==t.environment&&e.get(t.host+t.endpoints.getSpellen.url+n,function(e){r(e)}).fail(function(){i("server niet beschikbaar")})})},r=function(e){return t.environment=e,!0},i=function(n,r,i,a){return new Promise(function(o,s){e.ajax({url:t.host+t.endpoints.getSpellen.url+"zet/1",method:"PUT",contentType:"application/json; charset=utf-8",data:JSON.stringify({SpelToken:i,SpelerToken:a,X:n,Y:r,Pas:"false"}),success:function(e){o(e)},fail:function(e){s(e)}})})},a=function(n,r){return new Promise(function(i,a){e.ajax({url:t.host+t.endpoints.getSpellen.url+"zet/1",method:"PUT",contentType:"application/json; charset=utf-8",data:JSON.stringify({SpelToken:n,SpelerToken:r,X:0,Y:0,Pas:"true"}),success:function(e){i(e)},fail:function(e){a(e)}})})};return{getDog:function(){e.get("https://random.dog/woof.json",function(t){t.url.endsWith(".mp4")?e(".dog").append(e("<video controls autoplay>").attr("width","640").attr("height","360").append(e("<source>").attr("src",t.url).attr("type","video/mp4"))):e(".dog").append(e("<img>").attr("src",t.url))})},init:r,getSpellen:n,makeMove:i,makePas:a,giveUp:function(n){return new Promise(function(r,i){e.ajax({url:t.host+t.endpoints.getSpellen.url+"opgeven",method:"POST",contentType:"application/json, charset=utf-8",data:JSON.stringify({Token:n}),success:function(e){r(e)},fail:function(e){i(e)}}).fail(function(){i("problemen met server")})})}}}(jQuery),SPA.Model=function(e){var t,n=null,r=null,i=null,a=null,o=null,s=null,l=null,u=null,c=null,d=null,f=function(){var e=window.location.href.toString(),t=e.match(/\#(?:gameToken)\=([\S\s]*?)\&/)[1],i=e.match(/\#(?:playerToken)\=([\S\s]*?)\&/)[1];return n=t,r=i,SPA.Api.init(),p(),!0},p=function(){SPA.Data.getSpellen(n,r).then(function(t){l=t.aanDeBeurt,1==t.aanDeBeurt?o="wit":2==t.aanDeBeurt&&(o="zwart"),0==t.aanDeBeurt&&(e(".gameEnded").append(e("<a>").attr("href","/afterGame").html("stop game")),clearInterval(a),e(".informationGame").find(".set").html("geen zetten mogelijk")),null==s&&(t.spelerWitToken==r?(s="wit",u=1):t.spelerZwartToken==r&&(s="zwart",u=2)),i=t.aanDeBeurt,d=t.bordArray,SPA.Reversi.generateBoard(P(t.bordArray,c)),y(),b(),SPA.Grafiek.toonGrafiek(v(),S())}).then(function(){setInterval(function(){SPA.Data.getSpellen(n,r).then(function(t){1==t.aanDeBeurt?o="wit":2==t.aanDeBeurt&&(o="zwart"),l=t.aanDeBeurt,0==t.aanDeBeurt&&(e(".gameEnded").html(e("<a>").attr("href","/afterGame").html("stop game")),clearInterval(a),e(".informationGame").find(".set").html("geen zetten mogelijk")),null==s&&(t.spelerWitToken==r?(s="wit",u=1):t.spelerZwartToken==r&&(s="zwart",u=2)),"X"!=t.spelerWitToken&&"X"!=t.spelerZwartToken||(window.location="/afterGame"),i!=t.aanDeBeurt&&(i=t.aanDeBeurt,b()),k(d,t.bordArray)&&(console.log(d),console.log(t.bordArray),c=d,d=t.bordArray,SPA.Reversi.generateBoard(P(t.bordArray,c)),y(),SPA.Grafiek.toonGrafiek(v(),S()))})},1500)})},g=function(e,t){console.log("mijn nummer: "+u+", nummer aanzet: "+l),u==l?SPA.Data.makeMove(e,t,n,r).then(function(e){l==e.aanDeBeurt&&SPA.FeedbackWidget.toonErrorWidget("geen goede zet","#widget-container"),l=e.aanDeBeurt}).catch(function(e){SPA.FeedbackWidget.toonErrorWidget(e,"#widget-container")}):SPA.FeedbackWidget.toonErrorWidget("je bent niet aan de beurt","#widget-container")},m=function(){console.log(r),SPA.Data.giveUp(r).then(function(e){console.log(e)})},h=function(){u==l?SPA.Data.makePas(n,r).then(function(e){l!=e.aanDeBeurt&&SPA.FeedbackWidget.toonSuccessWidget("je hebt een beurt overgeslagen","#widget-container")}):SPA.FeedbackWidget.toonErrorWidget("je bent niet aan de beurt","#widget-container")},v=function(){for(var e=0,t=0;t<=7;t++)for(var n=0;n<=7;n++)1==d[t][n]&&e++;return e},S=function(){for(var e=0,t=0;t<=7;t++)for(var n=0;n<=7;n++)2==d[t][n]&&e++;return e},y=function(){for(var e=0,t=0,n=0;n<=7;n++)for(var r=0;r<=7;r++)1==d[n][r]?e++:2==d[n][r]&&t++;SPA.Reversi.showScore(e,t)},b=function(){SPA.Reversi.showGameInformation(s,o)},P=function(e,t){for(var n=[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],r=0;r<=7;r++)for(var i=0;i<=7;i++)n[r][i]=e[r][i],null!==t&&e[r][i]!==t[r][i]&&(1===e[r][i]?n[r][i]=11:2===e[r][i]&&(n[r][i]=22));return n},k=function(e,t){for(var n=0;n<7;n++)for(var r=0;r<7;r++)if(e[n][r]!=t[n][r])return!0};return t={giveUp:m},_defineProperty(t,"giveUp",m),_defineProperty(t,"makeMove",g),_defineProperty(t,"makePas",h),_defineProperty(t,"init",f),t}(jQuery),SPA.Reversi=function(e){var t,n=function(){return!0},r=function(t){e(".playground").html(SPA.Templating.parseTemplate("gameplay",{grid:t})),s(),i(),a(),o()},i=function(){e(".board td").click(function(){var t=parseInt(e(this).index())+1,n=parseInt(e(this).parent().index())+1;SPA.Model.makeMove(n,t)})},a=function(){e(".buttonPas").click(function(){SPA.Model.makePas()})},o=function(){e(".buttonGiveUp").click(function(){SPA.Model.giveUp()})},s=function(t,n){e(".score").html(spa_templates.src.js.templates.score({black:n,white:t}))},l=function(t,n){e(".gameInformation").html(spa_templates.src.js.templates.gameInformation({you:t,set:n}))};return t={showGameInformation:l},_defineProperty(t,"showGameInformation",l),_defineProperty(t,"showScore",s),_defineProperty(t,"generateBoard",r),_defineProperty(t,"init",n),t}(jQuery),SPA.FeedbackWidget=function(e){return{init:function(){return!0},toonSuccessWidget:function(e,t){new Widget("Success",e,t).Build()},toonErrorWidget:function(e,t){new Widget("Warning",e,t).Build()}}}(jQuery),SPA.Api=function(e){return{init:function(){SPA.Data.getDog()}}}(jQuery),SPA.Grafiek=function(e){return{init:function(){},toonGrafiek:function(e,t){console.log(e);var n=document.getElementById("grafiek").getContext("2d");console.log("test"),new Chart(n,{type:"bar",data:{labels:["White","Black"],datasets:[{label:"Aantal fiches",data:[e,t],backgroundColor:["rgba(200, 200, 200, 1)","rgba(0, 0, 0, 1)"],borderColor:["rgba(200, 200, 200, 1)","rgba(0, 0, 0, 1)"],borderWidth:1}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}})}}}(jQuery);var Widget=function(){function e(t,n,r){_classCallCheck(this,e),this.type=t,this.message=n,this.container=r}return _createClass(e,[{key:"Build",value:function(){this.ClearWidget(),this.CreateWidget(),this.AddEventListeners(),this.AddStorage()}},{key:"CreateWidget",value:function(){$(this.container).append($("<div>").attr("id","widget-success").append($("<div>").addClass("widget-symbol").append($("<i>").addClass("fas fa-check"))).append($("<div>").addClass("widget-exit").append($("<i>").addClass("fas fa-times"))).append($("<div>").addClass("widget-title").html()).append($("<div>").addClass("widget-content").html(this.message)).append($("<div>").addClass("widget-button-row").append($("<button>").html("Akkoord").addClass("btn").attr("id","ok")).append($("<button>").html("Annuleer").addClass("btn").attr("id","cancel")))),"Warning"===this.type&&($(".widget-symbol").find("i").remove("i"),$(".widget-symbol").append($("<i>").addClass("fas fa-exclamation-triangle")),$(".widget-button-row").hide(),$("#widget-success").attr("id","widget-warning"))}},{key:"AddEventListeners",value:function(){var e=this.container;$(".widget-exit").on("click",function(){$(e).animate({opacity:"-=1"},1500,function(){$(e).remove()})}),"Success"===this.type&&$(".btn").on("click",function(){$(e).animate({opacity:"-=1"},1500,function(){$(e).remove()})})}},{key:"ClearWidget",value:function(){var e=this.container;$(e).empty()}},{key:"AddStorage",value:function(){if(void 0===localStorage.items){for(var e=[],t=0;t<10;t+=1)e[t]="";localStorage.items=JSON.stringify(e)}else{var n=JSON.parse(localStorage.getItem("items"));n.push(this.type),n.shift(),localStorage.items=JSON.stringify(n)}console.log(localStorage)}}]),e}(),Template=function(e){return{init:function(){return!0}}}(jQuery);SPA.Templating=function(e){var t=function(e){return this.templates=e,!0},n=function(e){return spa_templates.src.js.templates[e]};return{init:t,getTemplate:n,parseTemplate:function(e,t){return n(e)(t)}}}(jQuery),Handlebars.registerHelper("ifEquals",function(e,t,n){return e===t?n.fn(this):n.inverse(this)}),Handlebars.registerHelper("times",function(e,t){for(var n="",r=0;r<e;++r)n+=t.fn(r);return n}),Handlebars.registerHelper("if_even",function(e,t){return e%2==0?t.fn(this):t.inverse(this)}),Handlebars.registerHelper("if_odd",function(e,t){return e%2==1?t.fn(this):t.inverse(this)}),Handlebars.registerHelper("if_changed",function(e){console.log(e)});